# AI Swarm v3.0.0 - Environment Configuration
# Copy into .env and fill in infrastructure-level values.
# APPLICATION SETTINGS (SCM, LLM Roles, Projects) have migrated to the DATABASE
# and should be configured via the Portal UI.
#
# QUICK START:
# 1. Copy this file to .env
# 2. Run ./setup.sh (generates SSH keys, selects proxy mode)
# 3. Run ./start.sh

# =============================================================================
# REVERSE PROXY CONFIGURATION
# =============================================================================
# Select your deployment method (setup.sh will configure this):
#   - local:   Direct port exposure, no SSL (for evaluation/development)
#   - caddy:   Bundled Caddy with automatic HTTPS (recommended for production)
#   - nginx:   Bundled Nginx (bring your own certs)
#   - traefik: External Traefik instance (advanced)
PROXY_MODE=local

# Domain configuration (used by caddy/nginx/traefik overlays)
PORTAL_DOMAIN=localhost
WEB_DOMAIN=localhost
# Temporal UI URL auto-derived as https://${PORTAL_DOMAIN}/temporal

# ACME/Let's Encrypt configuration (Caddy only)
# WARNING: Let's Encrypt allows only 5 duplicate certs per week!
# For testing, use staging CA:
#   ACME_CA=https://acme-staging-v02.api.letsencrypt.org/directory
# Or ZeroSSL (no rate limits for first 3 certs):
#   ACME_CA=https://acme.zerossl.com/v2/DV90
ACME_EMAIL=
ACME_CA=

# Traefik-specific (only if PROXY_MODE=traefik)
TRAEFIK_NETWORK=web-gateway
CERT_RESOLVER=letsencrypt
# IMPORTANT: Set this so all docker compose commands include the traefik overlay
# COMPOSE_FILE=docker-compose.yml:docker-compose.traefik.yml

# =============================================================================
# INFRASTRUCTURE: SCM Configuration (Global Settings)
# =============================================================================
# [DATABASE-BACKED] Configure via Portal > Settings > System
# Per-provider tokens are now used (azure-devops, github, gitlab).
# See Portal > Settings > System > Source Control Tokens
# Legacy fallback: SCM_TOKEN environment variable (not recommended)

# =============================================================================
# INFRASTRUCTURE: Claude Code Configuration
# =============================================================================
# [DATABASE-BACKED] Configure via Portal > Settings > System
CLAUDE_AUTH_MODE=oauth
Z_AI_API_KEY=your_zai_api_key_here

# =============================================================================
# INFRASTRUCTURE: Worker Configuration
# =============================================================================
# [DATABASE-BACKED] Configure via Portal > Settings > System
WORKER_COUNT=4

# [DATABASE-BACKED] LLM Role selection (planner, coder, reviewer)
# Configure via Portal > Settings > System

# =============================================================================
# INFRASTRUCTURE: Playwright Test Credentials
# =============================================================================
# [DATABASE-BACKED] Configure via Portal > Settings > System
# Used for post-deployment verification of authenticated pages
TEST_USER_EMAIL=test@example.com
TEST_USER_PASSWORD=your_test_password

# =============================================================================
# INFRASTRUCTURE: Defaults
# =============================================================================
# [DATABASE-BACKED] Configure via Portal > Settings > System
DEFAULT_PROJECT_DIR=/project
DEFAULT_AI_CONTEXT_FOLDER=.aicontext

# =============================================================================
# WORKSPACE CONFIGURATION
# =============================================================================
# Host path where all project folders are located.
# This is mounted to /apps inside containers.
# Default: ./workspace (relative to ai-swarm directory)
WORKSPACE_ROOT=./workspace

# =============================================================================
# SSH DEPLOYMENT KEYS (Required)
# =============================================================================
# Workers use SSH to deploy changes to Docker containers.
# These are auto-generated by setup.sh at ~/.ssh/ai-swarm-deploy
#
# IMPORTANT: Add the public key to each server's ~/.ssh/authorized_keys
# For same-host deployment, add to your local authorized_keys too.
SSH_KEY_PATH=~/.ssh/ai-swarm-deploy
SSH_KNOWN_HOSTS=~/.ssh/known_hosts

# =============================================================================
# REQUIRED: Authentication (Sovereign Auth)
# =============================================================================
# AI Swarm uses Sovereign Auth: Passkeys (WebAuthn) + CLI Magic Links
# No external OAuth providers required.

# Portal URL (used for magic link generation)
NEXTAUTH_URL=http://localhost:3000

# Session signing secret (generated automatically by setup.sh)
NEXTAUTH_SECRET=

# Portal URL alias (for CLI scripts)
PORTAL_URL=http://localhost:3000

# =============================================================================
# REQUIRED: Temporal Configuration
# =============================================================================

# Temporal server address
TEMPORAL_ADDRESS=temporal:7233

# Temporal namespace
TEMPORAL_NAMESPACE=ai-swarm

# =============================================================================
# OPTIONAL: Email Notifications
# =============================================================================

# Email provider (resend, sendgrid, mailgun)
EMAIL_PROVIDER=resend
EMAIL_API_KEY=
EMAIL_FROM=ai-swarm@example.com
EMAIL_TO=you@example.com

# =============================================================================
# DEPLOYMENT SETTINGS
# =============================================================================
# [DATABASE-BACKED] Configure via Portal > Settings > Project > Deployment
# These variables are no longer used in .env for v3.6.0+
# DEPLOY_DIR, DEPLOY_HOST, DEPLOY_USER, APP_URL, etc.

# Skip external CI/CD (GitLab Pipelines, etc.) when AI Swarm merges
# Set to 'true' if you have an external CI/CD pipeline that also deploys on push to main
# Whether to append [skip ci] to merge commit messages to coordinate with external CI/CD
SKIP_EXTERNAL_CI=false

# (Optional) Docker container name to inspect for deployment verification
# Example: DEPLOY_CONTAINER=my-app-name
DEPLOY_CONTAINER=



# Log level (debug, info, warn, error)
LOG_LEVEL=info

# =============================================================================
# Portal Configuration
# =============================================================================

# Portal port
PORTAL_PORT=3000

# Temporal UI port
TEMPORAL_UI_PORT=8233



# =============================================================================
# Redis Configuration
# =============================================================================

REDIS_URL=redis://redis:6379

# =============================================================================
# Maintenance Configuration
# =============================================================================

# Chat and task file retention in days
CHAT_MAX_AGE_DAYS=90

# Task directory for Gemini CLI async pattern
GEMINI_TASK_DIR=/tmp/ai-swarm

# Set to 'false' to keep task directories for debugging
GEMINI_CLEANUP_TASKS=true
